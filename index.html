<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vinted Tracker No√´l üéÑ</title>
<style>
/* ==== G√©n√©ral ==== */
body {
  font-family: 'Segoe UI', sans-serif;
  background: linear-gradient(135deg,#8B0000,#006400);
  color: #fff;
  padding: 20px;
  margin: 0;
  overflow-x: hidden;
  position: relative;
}

h1 {
  text-align: center;
  font-size: 2.5em;
  margin-bottom: 15px;
  color: #FFD700;
  text-shadow: 2px 2px 5px #000;
}

/* ==== Inputs et boutons ==== */
label { font-weight: bold; }
input, select, button {
  padding: 10px;
  margin: 5px 0;
  border-radius: 8px;
  border: none;
  font-size: 16px;
}

input, select { width: 100%; box-sizing: border-box; background:#272727; color:#fff; border:1px solid #444;}
input:focus, select:focus { outline:none; border-color:#FFD700;}

button { font-weight:bold; transition: all 0.2s; cursor:pointer; }
#addBtn { background:#FFD700; color:#8B0000; }
#addBtn:hover { background:#FFEA00; transform:scale(1.05); }
#deleteAllBtn { background:#FF4500; color:#fff; }
#deleteAllBtn:hover { background:#FF6347; transform:scale(1.05); }

/* ==== Tableau ==== */
#salesTable { width:100%; border-collapse:collapse; margin-top:20px; border-radius:12px; overflow:hidden; }
th, td { padding:12px; text-align:left; }
th { background:#272727; color:#FFD700; }
td { border-bottom:1px solid #333; }

/* Lignes altern√©es */
tr:nth-child(odd) { background: #550000; color: #fff; }
tr:nth-child(even) { background: #005500; color: #fff; }

/* Hover dor√© semi-transparent */
tr:hover {
  background: rgba(255,215,0,0.4);
  box-shadow:0 0 15px rgba(255,215,0,0.5);
  transition:0.3s;
}

/* Cadeau scintillant */
.profit-positive-row { 
  animation: glow 1s infinite alternate; 
  color: #000; 
}

@keyframes glow {
  0% { background-color: #00FF00; }
  50% { background-color: #32CD32; }
  100% { background-color: #00FF00; }
}

.fade-in { animation: fadeIn 0.5s ease-in-out; }
@keyframes fadeIn { from {opacity:0;} to {opacity:1;} }

.profit-positive { color:#00FF00; font-weight:bold; }
.profit-negative { color:#FF4500; font-weight:bold; }

/* ==== Total ==== */
#total { margin-top:20px; font-weight:bold; font-size:20px; text-align:right; color:#FFD700; }

/* ==== Container ==== */
.container { max-width:700px; margin:auto; }

/* ==== Graphique chantier ==== */
.graphBtn {
  display:inline-block; margin-top:20px; padding:15px 25px;
  background-color:#FF8C00; color:#fff; font-weight:bold; border-radius:12px;
  text-align:center; font-size:18px; position:relative; overflow:hidden; cursor:not-allowed;
  animation: shake 1s infinite, blink 1s infinite alternate;
}
.graphBtn::after { content:"üöß Graphique bient√¥t disponible"; }
@keyframes blink { 0% {background:#FF8C00;} 50%{background:#FFA500;} 100%{background:#FF8C00;} }
@keyframes shake {0%{transform:translateX(0);}25%{transform:translateX(-3px);}50%{transform:translateX(3px);}75%{transform:translateX(-3px);}100%{transform:translateX(0);}}

/* ==== Modal √©dition ==== */
.modal { display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.7); justify-content:center; align-items:center; }
.modal-content { background:#1e1e1e; padding:20px; border-radius:12px; text-align:center; width:300px; }
.modal-content input { width:100%; margin-bottom:10px; }
.modal-content button { width:45%; margin:5px; }

/* ==== Filtre ==== */
#filterWeek { margin-top:10px; background:#272727; color:#fff; }

/* ==== Responsive ==== */
@media(max-width:600px){
  th,td{font-size:14px;padding:8px;}
  h1{font-size:2em;}
  button,input,select{font-size:14px;padding:8px;}
}

/* ==== Neige ==== */
.snowflake {
  position: fixed;
  top: -10px;
  color: #fff;
  font-size: 1em;
  z-index: 9999;
  user-select: none;
  pointer-events: none;
  animation: fall linear infinite;
}
@keyframes fall {
  0% {transform: translateY(0) rotate(0deg);}
  100% {transform: translateY(100vh) rotate(360deg);}
}

/* ==== Mini sapin ==== */
#christmasTree {
  position: fixed; top: 20px; right: 20px; width: 50px; height: 100px;
  text-align:center; font-size:50px; color:#FFD700;
}
</style>
</head>
<body>
<div class="container">
  <h1>Vinted Tracker No√´l üéÑ</h1>

  <!-- Compteur No√´l -->
  <div id="christmasCounter" style="text-align:center; font-size:18px; margin-bottom:10px; font-weight:bold; color:#FFD700;"></div>

  <label>Nom de l'article :</label>
  <input type="text" id="itemName" placeholder="Ex: Pull Zara">

  <label>Prix d'achat (‚Ç¨) :</label>
  <input type="number" id="itemCost" placeholder="Ex: 10">

  <label>Prix de vente (‚Ç¨) :</label>
  <input type="number" id="itemPrice" placeholder="Ex: 25">

  <label>Frais Vinted (%) :</label>
  <input type="number" id="vintedFee" placeholder="Ex: 5" value="5">

  <label>Semaine de la vente :</label>
  <select id="filterWeek" onchange="filterWeek()">
    <option value="all">Toutes les semaines</option>
  </select>

  <button id="addBtn" onclick="addSale()">Mettre en vente</button>
  <button id="deleteAllBtn" onclick="deleteAllSales()">Tout supprimer</button>

  <table id="salesTable">
    <thead>
      <tr>
        <th>Article</th>
        <th>Prix d'achat (‚Ç¨)</th>
        <th>Prix de vente (‚Ç¨)</th>
        <th>Frais (‚Ç¨)</th>
        <th>Profit net (‚Ç¨)</th>
        <th>Date</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div id="total">Profit total : 0 ‚Ç¨</div>

  <div class="graphBtn"></div>
</div>

<!-- Modal √©dition -->
<div class="modal" id="editModal">
  <div class="modal-content">
    <h3>Modifier vente</h3>
    <input type="text" id="editName">
    <input type="number" id="editCost">
    <input type="number" id="editPrice">
    <input type="number" id="editFee">
    <br>
    <button onclick="saveEdit()">Sauvegarder</button>
    <button onclick="closeModal()">Annuler</button>
  </div>
</div>

<!-- Mini sapin de No√´l -->
<div id="christmasTree">üéÑ</div>

<script>
let sales = [], editIndex = null;

// ==== NEIGE ====
function createSnowflake(){
  const snow = document.createElement('div');
  snow.className = 'snowflake';
  snow.style.left=Math.random()*window.innerWidth+'px';
  snow.style.fontSize=(10+Math.random()*20)+'px';
  snow.style.animationDuration=(5+Math.random()*5)+'s';
  snow.innerHTML='‚ùÑ';
  document.body.appendChild(snow);
  setTimeout(()=>snow.remove(),10000);
}
setInterval(createSnowflake,200);

// ==== Compteur No√´l ====
function updateChristmasCounter() {
    const counter = document.getElementById("christmasCounter");
    const today = new Date();
    const month = today.getMonth(); // 0 = Janvier
    const day = today.getDate();

    if(month !== 11) { // pas d√©cembre
        counter.innerText = "üéÑ Compteur No√´l actif seulement en d√©cembre !";
        return;
    }

    if(day <= 28){
        counter.innerText = `üéÑ Jour ${day} du compte √† rebours de No√´l`;
        return;
    }

    const lastDays = {
        29: "Plus que 3 jours üéÖ",
        30: "Plus que 2 jours üéÖ",
        31: "Plus que 1 jour üéÖ ‚Äî derni√®re ligne droite !"
    };

    counter.innerText = lastDays[day] || "";
}
updateChristmasCounter();

// ==== Ventes ====
window.onload = () => {
  const saved = localStorage.getItem('vintedSales');
  if(saved) sales = JSON.parse(saved);
  sales.forEach(addSaleToTable);
  updateTotal();
  populateWeeks();
};

// ==== Ajout vente ====
function addSale(){
  const name = document.getElementById('itemName').value;
  const cost = parseFloat(document.getElementById('itemCost').value);
  const price = parseFloat(document.getElementById('itemPrice').value);
  const feePercent = parseFloat(document.getElementById('vintedFee').value);
  if(!name||isNaN(cost)||isNaN(price)||isNaN(feePercent)){ alert('Remplis tous les champs !'); return; }

  const fee = price*(feePercent/100);
  const profit = price - fee - cost;
  const date = new Date();
  const week = getWeekNumber(date);
  const sale = {name,cost,price,fee,profit,date:date.toISOString(),week};
  sales.push(sale);
  saveSales();
  addSaleToTable(sale,true);
  updateTotal();
  populateWeeks();
  showMessage(sale);
}

// ==== Tableau ====
function addSaleToTable(sale,fade=false){
  const table = document.querySelector('#salesTable tbody');
  const row = table.insertRow();
  if(fade) row.classList.add('fade-in');
  if(sale.profit>0) row.classList.add('profit-positive-row'); // cadeau scintillant
  let icon = sale.profit>50?'üéÅ':sale.profit>0?'‚õÑ':'‚ùÑ';
  row.innerHTML = `
    <td>${icon} ${sale.name}</td>
    <td>${sale.cost.toFixed(2)} ‚Ç¨</td>
    <td>${sale.price.toFixed(2)} ‚Ç¨</td>
    <td>${sale.fee.toFixed(2)} ‚Ç¨</td>
    <td class="${sale.profit>=0?'profit-positive':'profit-negative'}">${sale.profit.toFixed(2)} ‚Ç¨</td>
    <td>${new Date(sale.date).toLocaleDateString()}</td>
    <td>
      <button onclick="editSale(this)">‚úèÔ∏è</button>
      <button onclick="removeSale(this)">üóëÔ∏è</button>
    </td>
  `;
}

function removeSale(btn){
  const row=btn.parentNode.parentNode;
  sales.splice(row.rowIndex-1,1);
  saveSales();
  row.remove();
  updateTotal();
  populateWeeks();
}

function editSale(btn){
  const row=btn.parentNode.parentNode;
  editIndex = row.rowIndex-1;
  const sale = sales[editIndex];
  document.getElementById('editName').value=sale.name;
  document.getElementById('editCost').value=sale.cost;
  document.getElementById('editPrice').value=sale.price;
  document.getElementById('editFee').value=(sale.fee/sale.price*100).toFixed(2);
  document.getElementById('editModal').style.display='flex';
}

function saveEdit(){
  const name=document.getElementById('editName').value;
  const cost=parseFloat(document.getElementById('editCost').value);
  const price=parseFloat(document.getElementById('editPrice').value);
  const feePercent=parseFloat(document.getElementById('editFee').value);
  const fee = price*(feePercent/100);
  const profit = price - fee - cost;
  const week = getWeekNumber(new Date(sales[editIndex].date));
  sales[editIndex] = {name,cost,price,fee,profit,date:sales[editIndex].date,week};
  saveSales();
  reloadTable();
  closeModal();
}

function closeModal(){ document.getElementById('editModal').style.display='none'; }

function updateTotal(){
  const total = sales.reduce((a,s)=>a+s.profit,0);
  document.getElementById('total').textContent=`Profit total : ${total.toFixed(2)} ‚Ç¨`;
}

function saveSales(){ localStorage.setItem('vintedSales',JSON.stringify(sales)); }
function deleteAllSales(){ if(confirm("Tout supprimer ?")){ sales=[]; saveSales(); reloadTable(); populateWeeks(); } }
function reloadTable(){ document.querySelector('#salesTable tbody').innerHTML=''; sales.forEach(addSaleToTable); updateTotal(); }

function getWeekNumber(d){
  d=new Date(Date.UTC(d.getFullYear(),d.getMonth(),d.getDate()));
  const dayNum=d.getUTCDay()||7;
  d.setUTCDate(d.getUTCDate()+4-dayNum);
  const yearStart=new Date(Date.UTC(d.getUTCFullYear(),0,1));
  return Math.ceil((((d-yearStart)/86400000)+1)/7);
}

function populateWeeks(){
  const select=document.getElementById('filterWeek');
  const weeks=[...new Set(sales.map(s=>s.week))].sort((a,b)=>a-b);
  select.innerHTML='<option value="all">Toutes les semaines</option>';
  weeks.forEach(w=>{ const opt=document.createElement('option'); opt.value=w; opt.text=`Semaine ${w}`; select.appendChild(opt); });
}

function filterWeek(){
  const val=document.getElementById('filterWeek').value;
  const tbody=document.querySelector('#salesTable tbody');
  tbody.innerHTML='';
  sales.forEach(s=>{ if(val==='all'||s.week==val) addSaleToTable(s); });
  updateTotal();
}

function showMessage(sale){
  let msg='';
  if(sale.profit>50) msg=`üéÅ Ce ${sale.name} est un vrai cadeau pour ton profit ! +${sale.profit.toFixed(2)}‚Ç¨`;
  else if(sale.profit>0) msg=`‚õÑ ${sale.name} rapporte du cash ! +${sale.profit.toFixed(2)}‚Ç¨`;
  else msg=`‚ùÑ Oops, ${sale.name} n'√©tait pas rentable ! ${sale.profit.toFixed(2)}‚Ç¨`;
  alert(msg);
}

// ==== Mini sapin fixe ====
function updateChristmasTree(){
  const tree = document.getElementById('christmasTree');
  tree.style.fontSize = '50px';
  tree.style.color = '#FFD700';
}
updateChristmasTree();
</script>
</body>
</html>
